<!DOCTYPE html>
<html lang="id">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link href="https://fonts.googleapis.com/css?family=Poppins:400,500,600,700&display=swap" rel="stylesheet" />
    <link href="./css/main.css" rel="stylesheet" />
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <title>Dana Investor - Kembangin</title>
    <style>
      body { background: #f5f5f7; }
      
      .dashboard-nav {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        background: #fff;
        padding: 20px 0;
        box-shadow: 0 2px 8px rgba(0,0,0,0.08);
        z-index: 1000;
      }
      
      .dashboard-nav .nav-container {
        display: flex;
        align-items: center;
        justify-content: space-between;
        max-width: 1400px;
        margin: 0 auto;
        padding: 0 40px;
      }
      
      .dashboard-logo {
        display: flex;
        align-items: center;
        gap: 12px;
        font-size: 20px;
        font-weight: 700;
        color: #000;
      }
      
      .dashboard-logo img {
        width: 36px;
        height: 36px;
        object-fit: contain;
      }
      
      .dashboard-menu {
        display: flex;
        gap: 32px;
        align-items: center;
      }
      
      .dashboard-menu a {
        color: #666;
        text-decoration: none;
        font-size: 15px;
        font-weight: 500;
        transition: color 0.2s;
      }
      
      .dashboard-menu a:hover,
      .dashboard-menu a.active {
        color: #6c26d9;
      }
      
      .search-input {
        padding: 8px 16px;
        border: 1px solid #ddd;
        border-radius: 20px;
        font-size: 14px;
        outline: none;
        width: 200px;
      }
      
      /* Hero Section */
      .hero-section {
        margin-top: 80px;
        background: linear-gradient(135deg, #6c26d9 0%, #8b5cf6 100%);
        padding: 60px 40px;
        color: #fff;
      }
      
      .hero-content {
        max-width: 1400px;
        margin: 0 auto;
        display: flex;
        justify-content: space-between;
        align-items: flex-start;
        gap: 40px;
      }
      
      .hero-left h1 {
        font-size: 48px;
        font-weight: 700;
        margin-bottom: 0;
      }
      
      .hero-right {
        display: flex;
        align-items: center;
        gap: 20px;
      }
      
      .hero-right h2 {
        font-size: 48px;
        font-weight: 700;
        margin: 0;
        white-space: nowrap;
      }
      
      .date-selector {
        background: #fff;
        color: #000;
        padding: 12px 20px;
        border-radius: 8px;
        font-size: 16px;
        font-weight: 600;
        border: none;
        cursor: pointer;
        min-width: 180px;
      }
      
      /* Content Section */
      .content-section {
        max-width: 1400px;
        margin: 60px auto;
        padding: 0 40px;
      }
      
      .dashboard-grid {
        display: grid;
        grid-template-columns: 400px 1fr;
        gap: 40px;
        margin-bottom: 60px;
      }
      
      /* Chart Cards */
      .chart-card {
        background: #fff;
        border-radius: 16px;
        padding: 32px;
        box-shadow: 0 2px 12px rgba(0,0,0,0.08);
      }
      
      .chart-card h3 {
        font-size: 18px;
        font-weight: 600;
        color: #666;
        margin-bottom: 20px;
      }
      
      .chart-container {
        position: relative;
        width: 100%;
        height: 300px;
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
      }
      
      .chart-center-text {
        position: absolute;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        text-align: center;
      }
      
      .chart-center-text .number {
        font-size: 48px;
        font-weight: 700;
        color: #000;
      }
      
      .chart-center-text .label {
        font-size: 14px;
        color: #999;
        text-transform: uppercase;
        margin-top: -8px;
      }
      
      .chart-legend {
        display: flex;
        justify-content: center;
        gap: 16px;
        margin-top: 24px;
        flex-wrap: wrap;
      }
      
      .legend-item {
        display: flex;
        align-items: center;
        gap: 8px;
        padding: 6px 12px;
        border-radius: 20px;
        font-size: 12px;
        font-weight: 600;
      }
      
      .legend-color {
        width: 12px;
        height: 12px;
        border-radius: 50%;
      }
      
      .allocation-legend {
        display: flex;
        flex-direction: column;
        gap: 12px;
        margin-top: 24px;
      }
      
      .allocation-item {
        display: flex;
        align-items: center;
        justify-content: space-between;
        padding: 12px;
        background: #f9f9fb;
        border-radius: 8px;
      }
      
      .allocation-info {
        display: flex;
        align-items: center;
        gap: 12px;
      }
      
      .allocation-color {
        width: 16px;
        height: 16px;
        border-radius: 50%;
      }
      
      .allocation-label {
        font-size: 14px;
        color: #333;
      }
      
      .allocation-percentage {
        font-size: 16px;
        font-weight: 700;
        color: #000;
      }
      
      /* Transaction Table */
      .transaction-section {
        background: #fff;
        border-radius: 16px;
        padding: 32px;
        box-shadow: 0 2px 12px rgba(0,0,0,0.08);
      }
      
      .section-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 32px;
      }
      
      .section-title {
        font-size: 32px;
        font-weight: 700;
        color: #000;
      }
      
      .transaction-table {
        width: 100%;
        border-collapse: collapse;
      }
      
      .transaction-table thead {
        background: #f9f9fb;
      }
      
      .transaction-table th {
        padding: 16px;
        text-align: left;
        font-size: 14px;
        font-weight: 600;
        color: #666;
        border-bottom: 2px solid #e5e5e5;
      }
      
      .transaction-table td {
        padding: 20px 16px;
        font-size: 15px;
        color: #333;
        border-bottom: 1px solid #f0f0f0;
      }
      
      .transaction-table tbody tr:hover {
        background: #f9f9fb;
      }
      
      /* Summary Cards */
      .summary-grid {
        display: grid;
        grid-template-columns: repeat(2, 1fr);
        gap: 20px;
        margin-bottom: 40px;
      }
      
      .summary-card {
        background: #fff;
        border-radius: 12px;
        padding: 24px;
        box-shadow: 0 2px 12px rgba(0,0,0,0.08);
        display: flex;
        align-items: center;
        gap: 16px;
      }
      
      .summary-icon {
        width: 50px;
        height: 50px;
        border-radius: 12px;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 24px;
        flex-shrink: 0;
      }
      
      .summary-icon.purple {
        background: linear-gradient(135deg, #6c26d9 0%, #8b5cf6 100%);
      }
      
      .summary-icon.blue {
        background: linear-gradient(135deg, #3b82f6 0%, #2563eb 100%);
      }
      
      .summary-icon.green {
        background: linear-gradient(135deg, #10b981 0%, #059669 100%);
      }
      
      .summary-icon.orange {
        background: linear-gradient(135deg, #f59e0b 0%, #d97706 100%);
      }
      
      .summary-info h4 {
        font-size: 14px;
        font-weight: 500;
        color: #666;
        margin-bottom: 4px;
      }
      
      .summary-info .value {
        font-size: 24px;
        font-weight: 700;
        color: #000;
      }
      
      /* Info Box */
      .info-box {
        background: #f9f9fb;
        border-left: 4px solid #6c26d9;
        padding: 24px;
        border-radius: 8px;
        margin-top: 32px;
      }
      
      .info-box p {
        font-size: 15px;
        line-height: 1.6;
        color: #333;
        margin: 0;
      }
      
      .info-box strong {
        color: #000;
      }
      
      /* No Data Message */
      .no-data {
        text-align: center;
        padding: 60px 20px;
        color: #999;
      }
      
      .no-data p {
        font-size: 16px;
        margin-bottom: 20px;
      }
      
      .no-data a {
        color: #6c26d9;
        text-decoration: none;
        font-weight: 600;
      }
      
      @media (max-width: 1024px) {
        .dashboard-grid {
          grid-template-columns: 1fr;
        }
        
        .hero-content {
          flex-direction: column;
          align-items: flex-start;
        }
        
        .hero-right {
          width: 100%;
          flex-direction: column;
          align-items: flex-start;
        }
        
        .hero-right h2 {
          font-size: 36px;
        }
        
        .date-selector {
          width: 100%;
        }
        
        .summary-grid {
          grid-template-columns: 1fr;
        }
      }
      
      @media (max-width: 768px) {
        .hero-left h1 {
          font-size: 32px;
        }
        
        .hero-right h2 {
          font-size: 28px;
        }
        
        .dashboard-menu {
          display: none;
        }
        
        .transaction-table {
          font-size: 13px;
        }
        
        .transaction-table th,
        .transaction-table td {
          padding: 12px 8px;
        }
      }
    </style>
  </head>
  <body>
    <!-- Dashboard Navigation -->
    <nav class="dashboard-nav">
      <div class="nav-container">
        <div class="dashboard-logo">
          <img src="images/logo%20kelompok%2011%20vinix-01.png" alt="Logo" />
          <span>Dana Investasi</span>
        </div>
        <div class="dashboard-menu">
          <a href="dashboard-mitra-umkm.html">Dashboard</a>
          <a href="influencer-page.html">Influencer</a>
          <a href="dana_investor_page.html" class="active">Dana Investor</a>
          <a href="milestone-page.html">Milestone</a>
          <a href="#">Pelatihan</a>
          <a href="profil-mitra-page.html">Profil</a>
          <input type="text" class="search-input" placeholder="Cari di situs" />
        </div>
      </div>
    </nav>

    <!-- Hero Section -->
    <section class="hero-section">
      <div class="hero-content">
        <div class="hero-left">
          <h1>Total Dana Investor</h1>
        </div>
        <div class="hero-right">
          <h2></h2>
          <select class="date-selector" id="dateSelector">
            <option value="2025-01-10">10 Oktober 2025</option>
            <option value="2025-01-09">09 Oktober 2025</option>
            <option value="2025-01-08">08 Oktober 2025</option>
            <option value="2025-01-07">07 Oktober 2025</option>
          </select>
        </div>
      </div>
    </section>

    <!-- Content Section -->
    <section class="content-section">
      <!-- Summary Cards -->
      <div class="summary-grid">
        <div class="summary-card">
          <div class="summary-icon purple">üí∞</div>
          <div class="summary-info">
            <h4>Total Dana</h4>
            <div class="value" id="totalInvestasi">Rp 0</div>
          </div>
        </div>
        
        <div class="summary-card">
          <div class="summary-icon blue">üë•</div>
          <div class="summary-info">
            <h4>Jumlah Investor</h4>
            <div class="value" id="totalInvestor">0</div>
          </div>
        </div>
        
        <div class="summary-card">
          <div class="summary-icon green">üíµ</div>
          <div class="summary-info">
            <h4>Dana Tersalurkan</h4>
            <div class="value" id="danaTersalurkan">Rp 0</div>
          </div>
        </div>
        
        <div class="summary-card">
          <div class="summary-icon orange">‚è≥</div>
          <div class="summary-info">
            <h4>Dana Tertunda</h4>
            <div class="value" id="danaTertunda">Rp 0</div>
          </div>
        </div>
      </div>

      <!-- Dashboard Grid -->
      <div class="dashboard-grid">
        <!-- Pie Chart - Total Dana -->
        <div class="chart-card">
          <h3>Total Dana <span id="chartDate">10 Oktober 2025</span></h3>
          <div class="chart-container">
            <canvas id="investorChart"></canvas>
            <div class="chart-center-text">
              <div class="number" id="chartInvestorCount">0</div>
              <div class="label">INVESTOR</div>
            </div>
          </div>
          <div class="chart-legend" id="chartLegend">
            <!-- Legend items will be generated here -->
          </div>
        </div>

        <!-- Transaction Table -->
        <div class="transaction-section">
          <table class="transaction-table">
            <thead>
              <tr>
                <th>Tanggal</th>
                <th>Investor</th>
                <th>Jumlah</th>
              </tr>
            </thead>
            <tbody id="transactionTableBody">
              <!-- Rows will be generated here -->
            </tbody>
          </table>
          
          <div id="noDataMessage" class="no-data" style="display: none;">
            <p>Belum ada data investasi untuk UMKM Anda.</p>
            <a href="umkm.html">Bagikan profil UMKM Anda</a>
          </div>
        </div>
      </div>

      <!-- Allocation Chart -->
      <div class="chart-card">
        <h3>Alokasi Dana</h3>
        <div class="chart-container" style="height: 250px;">
          <canvas id="allocationChart"></canvas>
        </div>
        <div class="allocation-legend">
          <div class="allocation-item">
            <div class="allocation-info">
              <div class="allocation-color" style="background: #8b5cf6;"></div>
              <span class="allocation-label">Dana Belum Disalurkan</span>
            </div>
            <span class="allocation-percentage" id="percentageUnallocated">0%</span>
          </div>
          <div class="allocation-item">
            <div class="allocation-info">
              <div class="allocation-color" style="background: #3b82f6;"></div>
              <span class="allocation-label">Dana Tersalurkan Ke UMKM</span>
            </div>
            <span class="allocation-percentage" id="percentageAllocated">0%</span>
          </div>
        </div>
      </div>

      <!-- Info Box -->
      <div class="info-box">
        <p>
          <strong>Informasi:</strong> Total investasi saat ini mencapai <span id="infoTotalAmount">Rp 0</span> dari <span id="infoInvestorCount">0</span> investor aktif.
          Sebanyak <span id="infoAllocatedPercent">0%</span> dana sudah disalurkan ke UMKM, sementara sisanya masih menunggu proses verifikasi dan pencairan.
        </p>
      </div>
    </section>

    <script>
      // Color palette
      const colors = [
        '#ef4444', // red
        '#f59e0b', // orange
        '#8b5cf6', // purple
        '#3b82f6', // blue
        '#10b981', // green
        '#ec4899', // pink
      ];

      // Check if user is logged in as mitra
      let currentMitra = null;
      (function(){
        try {
          const mitraData = localStorage.getItem('currentMitra');
          if(!mitraData) {
            alert('Anda harus login sebagai mitra terlebih dahulu.');
            window.location.href = 'login-mitra-page.html';
            return;
          }
          currentMitra = JSON.parse(mitraData);
        } catch(e) {
          window.location.href = 'login-mitra-page.html';
        }
      })();

      // Get investments for current UMKM
      function getUmkmInvestments() {
        try {
          // Get all investments from localStorage
          const allInvestments = JSON.parse(localStorage.getItem('umkmInvestments') || '{}');
          
          // Get investments for current mitra (using email as key)
          const mitraEmail = currentMitra ? currentMitra.email : '';
          return allInvestments[mitraEmail] || [];
        } catch(e) {
          return [];
        }
      }

      // Format currency
      function formatCurrency(amount) {
        return 'Rp ' + amount.toLocaleString('id-ID');
      }

      // Format date
      function formatDate(dateString) {
        const date = new Date(dateString);
        return date.toLocaleDateString('id-ID', { day: 'numeric', month: 'short', year: 'numeric' });
      }

      // Calculate statistics
      function calculateStats(investments) {
        const total = investments.reduce((sum, inv) => sum + inv.nominal, 0);
        const uniqueInvestors = [...new Set(investments.map(inv => inv.investorName))].length;
        const allocated = Math.floor(total * 0.75); // 75% allocated
        const pending = total - allocated;
        
        return {
          total,
          uniqueInvestors,
          allocated,
          pending,
          allocatedPercent: investments.length > 0 ? 75 : 0,
          pendingPercent: investments.length > 0 ? 25 : 0
        };
      }

      // Update summary cards
      function updateSummaryCards(stats) {
        document.getElementById('totalInvestasi').textContent = formatCurrency(stats.total);
        document.getElementById('totalInvestor').textContent = stats.uniqueInvestors;
        document.getElementById('danaTersalurkan').textContent = formatCurrency(stats.allocated);
        document.getElementById('danaTertunda').textContent = formatCurrency(stats.pending);
        
        // Update info box
        document.getElementById('infoTotalAmount').textContent = formatCurrency(stats.total);
        document.getElementById('infoInvestorCount').textContent = stats.uniqueInvestors;
        document.getElementById('infoAllocatedPercent').textContent = stats.allocatedPercent + '%';
      }

      // Create investor pie chart
      function createInvestorChart(investments) {
        const ctx = document.getElementById('investorChart');
        
        if(investments.length === 0) {
          document.getElementById('chartInvestorCount').textContent = '0';
          return;
        }

        // Group by investor
        const investorData = {};
        investments.forEach(inv => {
          if(!investorData[inv.investorName]) {
            investorData[inv.investorName] = 0;
          }
          investorData[inv.investorName] += inv.nominal;
        });

        const labels = Object.keys(investorData);
        const data = Object.values(investorData);
        const total = data.reduce((sum, val) => sum + val, 0);
        const percentages = data.map(val => Math.round((val / total) * 100));

        document.getElementById('chartInvestorCount').textContent = labels.length;

        // Create legend
        const legendContainer = document.getElementById('chartLegend');
        legendContainer.innerHTML = '';
        labels.forEach((label, index) => {
          const item = document.createElement('div');
          item.className = 'legend-item';
          item.style.background = colors[index % colors.length] + '20';
          item.innerHTML = `
            <div class="legend-color" style="background: ${colors[index % colors.length]}"></div>
            <span style="color: #000; text-transform: uppercase;">${label}</span>
          `;
          legendContainer.appendChild(item);
        });

        new Chart(ctx, {
          type: 'doughnut',
          data: {
            labels: labels,
            datasets: [{
              data: data,
              backgroundColor: colors.slice(0, labels.length),
              borderWidth: 0,
              cutout: '70%'
            }]
          },
          options: {
            responsive: true,
            maintainAspectRatio: false,
            plugins: {
              legend: { display: false },
              tooltip: {
                callbacks: {
                  label: function(context) {
                    return context.label + ': ' + formatCurrency(context.raw) + ' (' + percentages[context.dataIndex] + '%)';
                  }
                }
              }
            }
          }
        });
      }

      // Create allocation chart
      function createAllocationChart(stats) {
        const ctx = document.getElementById('allocationChart');
        
        document.getElementById('percentageUnallocated').textContent = stats.pendingPercent + '%';
        document.getElementById('percentageAllocated').textContent = stats.allocatedPercent + '%';

        new Chart(ctx, {
          type: 'doughnut',
          data: {
            labels: ['Dana Belum Disalurkan', 'Dana Tersalurkan Ke UMKM'],
            datasets: [{
              data: [stats.pending, stats.allocated],
              backgroundColor: ['#8b5cf6', '#3b82f6'],
              borderWidth: 0,
              cutout: '75%'
            }]
          },
          options: {
            responsive: true,
            maintainAspectRatio: false,
            plugins: {
              legend: { display: false },
              tooltip: {
                callbacks: {
                  label: function(context) {
                    const percentage = context.dataIndex === 0 ? stats.pendingPercent : stats.allocatedPercent;
                    return context.label + ': ' + formatCurrency(context.raw) + ' (' + percentage + '%)';
                  }
                }
              }
            }
          }
        });
      }

      // Populate transaction table
      function populateTransactionTable(investments) {
        const tbody = document.getElementById('transactionTableBody');
        const noDataMsg = document.getElementById('noDataMessage');
        
        if(investments.length === 0) {
          tbody.innerHTML = '';
          noDataMsg.style.display = 'block';
          return;
        }

        noDataMsg.style.display = 'none';
        tbody.innerHTML = '';
        
        // Sort by date (newest first)
        const sorted = [...investments].sort((a, b) => new Date(b.date) - new Date(a.date));
        
        sorted.forEach(inv => {
          const row = document.createElement('tr');
          row.innerHTML = `
            <td>${formatDate(inv.date)}</td>
            <td><strong>${inv.investorName}</strong></td>
            <td><strong>${formatCurrency(inv.nominal)}</strong></td>
          `;
          tbody.appendChild(row);
        });
      }

      // Initialize page
      function initializePage() {
        const investments = getUmkmInvestments();
        const stats = calculateStats(investments);
        
        updateSummaryCards(stats);
        createInvestorChart(investments);
        createAllocationChart(stats);
        populateTransactionTable(investments);
      }

      // Date selector change handler
      document.getElementById('dateSelector').addEventListener('change', function() {
        const selectedDate = this.value;
        document.getElementById('chartDate').textContent = formatDate(selectedDate);
        // In a real app, you would filter data by date here
      });

      // Initialize on page load
      initializePage();
    </script>
  </body>
</html>